trigger:
  branches:
    include:
      - main
      - dev
      - uat

pool:
  name: 'Default'  # 你的 Self-hosted Agent Pool

steps:
- script: |
    python3 --version
    which python3
  displayName: 'Check Python Version'

- script: |
    python -m pip install --upgrade pip
    pip install -r flask_app/requirements.txt
  displayName: 'Install Dependencies'

- script: |
    python flask_app/app.py &
    echo "Flask app is running in background..."
    sleep 5  # 等待 Flask 啟動
  displayName: 'Start Flask App'

- script: |
    pytest flask_app/tests
  displayName: 'Run API Tests'

- script: |
    pkill -f app.py || echo "Flask process not found"
  displayName: 'Stop Flask App'